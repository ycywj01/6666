import serial
import time

ser = serial.Serial('COM11', 9600, parity=serial.PARITY_EVEN, bytesize=serial.EIGHTBITS, stopbits=serial.STOPBITS_ONE)

if ser.is_open:
    print('串口已经打开')

# data_to_send = [0x03, 0x03, 0x02, 0x76, 0x00, 0x01, 0x65, 0x8A]
# data_to_send2 = [0x03, 0x03, 0x02, 0xE0, 0x00, 0x01, 0x85, 0xA6]
# data_to_send = [0x01, 0x03, 0x00, 0x01, 0x00, 0x03, 0x55, 0xE9]
data_to_send2 = [0x68, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x68, 0x04, 0x04, 0x33, 0xF3, 0xF3, 0x3B, 0x2E, 0x16]#清空拓扑记录
data_to_send = [0x68, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x68, 0x04, 0x08, 0x37, 0x33, 0x34, 0x34, 0x00, 0x02, 0xAA, 0xE9, 0x46, 0x16]#请求拓扑记录

data_to_send_clr = [0x68, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x68, 0x04, 0x04, 0x33, 0xF3, 0xF3, 0x3B, 0x2F, 0x16]
data_to_send_read = [0x68, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x68, 0x04,0x06, 0x34, 0xF3,0xF3,0x3B,0x34,0x34,0x9A,0x16]
ser.write(bytes(data_to_send_clr))
print(ser.read_until(b'\x16').hex())
ser.write(bytes(data_to_send))
t = time.time()
print(t)
#time.sleep(180)
print(ser.read_until(b'\x16').hex())#因为机器码是以16为结尾的，所以读到16就结束可以读整行
time.sleep(30)
ser.write(bytes(data_to_send_read))
print(ser.read_until(b'\x16').hex())
#同一台断路器要发送两次拓扑信号中间要等待180s但是不同的断路器则只要等待30s，有两台串联就可以测试
print(11)
time.sleep(180)
ser.write(bytes(data_to_send))
print(ser.read_until(b'\x16').hex())
print(11)
exit()
time.sleep(180)
ser.write(bytes(data_to_send))
print(ser.read_until(b'\x16').hex())
print(11)
exit()
